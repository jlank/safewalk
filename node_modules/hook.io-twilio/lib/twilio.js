var Hook = require('hook.io').Hook,
    http = require('http'),
    util = require('util');

var TwilioHook = exports.TwiloHook = function(options){

  var self = this;

  Hook.call(self, options);

  self.on('hook::ready', function(){

    var sys = require('sys'),
         TwilioClient = require('twilio').Client,
         client = new TwilioClient(self.config.get('twilio:sID'), self.config.get('twilio:authToken'), 'localhost');

   self.phone = client.getPhoneNumber('+155555555556');

   self.on('*::sendSms', function(event, data){
    self.sendSms(data);
   });

  });

};

// TwilioHook inherits from Hook
util.inherits(TwilioHook, Hook);

TwilioHook.prototype.sendSms = function(data){

  var self = this;

  self.phone.setup(function() {
   self.phone.sendSms(data.smsNumber, data.message, null, function(sms) {
      sms.on('processed', function(reqParams, response) {
          console.log('Message processed, request params follow');
          console.log(reqParams);
      });
    });
  });

};

